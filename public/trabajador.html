<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <title>Panel del Trabajador</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="/style.css" />
</head>
<body>
  <header class="site-header">
    <div class="container header-inner">
      <div class="brand"><span class="brand-text">Panel del Trabajador</span></div>
      <button class="btn-icon" id="btnSalir" title="Cerrar sesión" aria-label="Cerrar sesión">
        <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M15 12H3" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          <path d="M11 8L15 12L11 16" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          <path d="M9 3H17C18.1046 3 19 3.89543 19 5V19C19 20.1046 18.1046 21 17 21H9" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </svg>
      </button>
    </div>
  </header>

  <div class="container" style="padding: 1.5rem 0;">
    <main class="main">
      <div class="panel">
        <div class="panel-header">
          <h1>Mi Información</h1>
        </div>
        <div id="infoEmpleado" class="form-wrap" style="padding:.5rem 1rem; margin-bottom:1rem;">
          <div style="color:var(--text-muted);">Cargando...</div>
        </div>
        <div class="form-wrap">
          <div class="form-header"><h3 class="form-heading">Asistencia</h3></div>
          <div style="display:flex; gap:.5rem; align-items:center; flex-wrap:wrap;">
            <button id="btnEntrada" class="btn-primary">Marcar entrada</button>
            <button id="btnSalida" class="btn-secondary">Marcar salida</button>
            <button id="btnAsistencia" class="btn-outline" title="Sólo estado rápido">Marcar asistencia</button>
            <div id="msgAsistencia" class="form-msg" style="margin:0;"></div>
            <button id="btnEnrollFaceTrab" type="button" class="btn-outline" style="display:none">Registrar mi rostro</button>
          </div>
          <div id="resumenAsistencia" class="kpi-bar" style="margin-top:.5rem;">
            <div class="kpi-item"><div class="kpi-num" id="kpiEntrada">—</div><div class="kpi-label">Última entrada</div></div>
            <div class="kpi-item"><div class="kpi-num" id="kpiSalida">—</div><div class="kpi-label">Última salida</div></div>
            <div class="kpi-item"><div class="kpi-num" id="kpiSemana">—</div><div class="kpi-label">Horas esta semana</div></div>
          </div>
          <div id="faceEnrollAreaTrab" style="display:block; margin-left: auto; margin-right: auto;">
            <video id="faceVideoTrab" autoplay muted playsinline class="video-face"></video>
            <div class="btn-face-group" style="margin-top:.5rem;">
              <button id="btnInitCamTrab" type="button" class="btn-primary btn-face">Activar Cámara</button>
              <button id="btnCaptureFaceTrab" type="button" class="btn-secondary btn-face" disabled>Capturar & Guardar</button>
              <button id="btnCerrarFaceTrab" type="button" class="btn-outline btn-face">Cerrar</button>
            </div>
            <div id="msgFaceTrab" class="form-msg" style="min-height:1.1rem; margin-top:.25rem;"></div>
          </div>
        </div>
      </div>

      <div class="panel" style="margin-top:1rem;">
        <div class="panel-header">
          <h1>Mis Tareas</h1>
          <div class="header-actions"><button class="btn-icon" id="btnRefrescar" title="Actualizar"></button></div>
        </div>
        <div id="listaTareas" class="table-wrap" style="padding: .5rem;"></div>
      </div>

      <div class="panel" style="margin-top:1rem;">
        <div class="panel-header">
          <h1>Inventario</h1>
          <div class="header-actions">
            <input id="buscarInvTrab" class="input" placeholder="Buscar material" style="max-width:240px;" />
          </div>
        </div>
        <div id="catalogoMaterialesTrab" class="table-wrap" style="padding:.5rem;"></div>
        <div class="form-wrap">
          <div class="form-header"><h3 class="form-heading">Consumir material</h3></div>
          <form id="formConsumirMaterial" class="dyn-form">
            <div>
              <label>Material</label>
              <select id="selMaterialTrab" name="idMaterial" required></select>
            </div>
            <div>
              <label>Cantidad</label>
              <input type="number" name="cantidad" min="1" required />
            </div>
            <button type="submit">Consumir</button>
          </form>
          <div id="msgConsumirMaterial" class="form-msg"></div>
        </div>
      </div>
    </main>
  </div>

  <!-- Librería face-api local -->
  <script src="/vendor/face-api/face-api.js" crossorigin="anonymous"></script>
  <script src="/trabajador.js"></script>
</body>
</html>
